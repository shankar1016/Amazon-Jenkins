@echo off
setlocal

REM Set the working directory (optional)
set WORKSPACE=%CD%

REM Define repository URL and branch
set REPO_URL=https://github.com/shankar1016/javaproj.git
set BRANCH=main

REM Clone or pull the latest code
if exist %WORKSPACE%\.git (
    echo Pulling latest code from %REPO_URL%
    git -C %WORKSPACE% pull origin %BRANCH%
) else (
    echo Cloning repository from %REPO_URL%
    git clone -b %BRANCH% %REPO_URL% %WORKSPACE%
)

REM Change to the workspace directory
cd %WORKSPACE%

REM Compile and build using Maven
echo Running Maven compile and install
mvn clean install

REM Check if Maven build was successful
if %ERRORLEVEL% NEQ 0 (
    echo Build failed with error code %ERRORLEVEL%
    exit /b %ERRORLEVEL%
) else (
    echo Build succeeded
)

endlocal
